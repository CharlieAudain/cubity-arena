rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Base path for the app
    match /artifacts/cubity-v1 {
        
        // Public Data
        match /public/data {
            match /rooms/{roomId} {
                allow read, create: if request.auth != null;
                allow update, delete: if request.auth != null && resource.data.createdBy == request.auth.uid;
            }
            match /banned_users/{user} {
                allow read: if request.auth != null;
            }
            match /usernames/{username} {
                allow read: if true;
                allow write: if request.auth != null;
            }
        }

        // Users Collection
        match /users/{userId} {
            // Allow access to user doc and all subcollections (profile, solves, etc.)
            match /{document=**} {
                allow read, write: if request.auth != null && request.auth.uid == userId;
            }
        }
    }
  }
}
